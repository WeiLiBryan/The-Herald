<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Show polygon information on click</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%;}
#popup {
    background: #fff;
    position: absolute;
    z-index: 1;
    border-radius: 3px;
    width: 40%;
    height: 900px;
    border: 1px solid rgba(0,0,0,0.4);
    font-family: 'Open Sans', sans-serif;
    font-size: 20px;
    right:0;
    padding: 5px; 
    overflow-y: scroll;
}

</style>
</head>
<body>
<style>
    .mapboxgl-popup {
        max-width: 400px;
        font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
    }
</style>
<div id="popup">Click on a country to view news</div>
<div id="map"></div>

<script>
	mapboxgl.accessToken = 'pk.eyJ1Ijoid2lsbGlhbWJyeWFuIiwiYSI6ImNrbG9hbWEybDAyOTAycG8waDJucjFrODcifQ.SdtJrsi2-DXjfbHIWIcDVA';
  const API_KEY = "e0f07ff44c4a4914a78bf913d06b2a60";

  var map = new mapboxgl.Map({
  container: 'map', //this is the id of the container you want your map in
  style: 'mapbox://styles/mapbox/light-v9', // this controls the style of the map. Want to see more? Try changing 'light' to 'simple'. 
  minZoom: 2 // We want our map to start out pretty zoomed in to start.
});

map.on('load', function() { //On map load, we want to do some stuff
  map.addLayer({ //here we are adding a layer containing the tileset we just uploaded
    'id': 'countries',//this is the name of our layer, which we will need later
    'source': {
      'type': 'vector',
      'url': 'mapbox://byfrost-articles.74qv0xp0' // <--- Add the Map ID you copied here
    },
    'source-layer': 'ne_10m_admin_0_countries-76t9ly', // <--- Add the source layer name you copied here
    'type': 'fill',
    'paint': {
      'fill-color': '#52489C', //this is the color you want your tileset to have (I used a nice purple color)
      'fill-outline-color': '#F2F2F2' //this helps us distinguish individual countries a bit better by giving them an outline
    }
  });
  
  map.setFilter('countries', ['in', 'ADM0_A3_IS'].concat(["ABW",
  "AFG",
  "AGO",
  "AIA",
  "ALA",
  "ALB",
  "AND",
  "ANT",
  "ARE",
  "ARG",
  "ARM",
  "ASM",
  "ATA",
  "ATF",
  "ATG",
  "AUS",
  "AUT",
  "AZE",
  "BDI",
  "BEL",
  "BEN",
  "BFA",
  "BGD",
  "BGR",
  "BHR",
  "BHS",
  "BIH",
  "BLM",
  "BLR",
  "BLZ",
  "BMU",
  "BOL",
  "BRA",
  "BRB",
  "BRN",
  "BTN",
  "BVT",
  "BWA",
  "CAF",
  "CAN",
  "CCK",
  "CHE",
  "CHL",
  "CHN",
  "CIV",
  "CMR",
  'COD',
  "COG",
  'COK',
  'COL',
  'COM',
  'CPV',
  'CRI',
  'CUB',
  'CXR',
  'CYM',
  'CYP',
  'CZE',
  'DEU',
  'DJI',
  'DMA',
  'DNK',
  'DOM',
  'DZA',
  'ECU',
  'EGY',
  'ERI',
  'ESH',
  'ESP',
  'EST',
  'ETH',
  'FIN',
  'FJI',
  'FLK',
  'FRA',
  'FRO',
  'FSM',
  'GAB',
  'GBR',
  'GEO',
  'GGY',
  'GHA',
  'GIB',
  'GIN',
  'GLP',
  'GMB',
  'GNB',
  'GNQ',
  'GRC',
  'GRD',
  'GRL',
  'GTM',
  'GUF',
  'GUM',
  'GUY',
  'HKG',
  'HMD',
  'HND',
  'HRV',
  'HTI',
  'HUN',
  'IDN',
  'IMN',
  'IND',
  'IOT',
  'IRL',
  'IRN',
  'IRQ',
  'ISL',
  'ISR',
  'ITA',
  'JAM',
  'JEY',
  'JOR',
  'JPN',
  'KAZ',
  'KEN',
  'KGZ',
  'KHM',
  'KIR',
  'KNA',
  'KOR',
  'KWT',
  'LAO',
  'LBN',
  'LBR',
  'LBY',
  'LCA',
  'LIE',
  'LKA',
  'LSO',
  'LTU',
  'LUX',
  'LVA',
  'MAC',
  'MAF',
  'MAR',
  'MCO',
  'MDA',
  'MDG',
  'MDV',
  'MEX',
  'MHL',
  'MKD',
  'MLI',
  'MLT',
  'MMR',
  'MNE',
  'MNG',
  'MNP',
  'MOZ',
  'MRT',
  'MSR',
  'MTQ',
  'MUS',
  'MWI',
  'MYS',
  'MYT',
  'NAM',
  'NCL',
  'NER',
  'NFK',
  'NGA',
  'NIC',
  'NIU',
  'NLD',
  'NOR',
  'NPL',
  'NRU',
  'NZL',
  'OMN',
  'PAK',
  'PAN',
  'PCN',
  'PER',
  'PHL',
  'PLW',
  'PNG',
  'POL',
  'PRI',
  'PRK',
  'PRT',
  'PRY',
  'PSE',
  'PYF',
  'QAT',
  'REU',
  'ROU',
  'RUS',
  'RWA',
  'SAU',
  'SDN',
  'SEN',
  'SGP',
  'SGS',
  'SHN',
  'SJM',
  'SLB',
  'SLE',
  'SLV',
  'SMR',
  'SOM',
  'SPM',
  'SRB',
  'STP',
  'SUR',
  'SVK',
  'SVN',
  'SWE',
  'SWZ',
  'SYC',
  'SYR',
  'TCA',
  'TCD',
  'TGO',
  'THA',
  'TJK',
  'TKL',
  'TKM',
  'TLS',
  'TON',
  'TTO',
  'TUN',
  'TUR',
  'TUV',
  'TWN',
  'TZA',
  'UGA',
  'UKR',
  'UMI',
  'URY',
  'USA',
  'UZB',
  'VAT',
  'VCT',
  'VEN',
  'VGB',
  'VIR',
  'VNM',
  'VUT',
  'WLF',
  'WSM',
  'YEM',
  'ZAF',
  'ZMB',
  'ZWE',
  "SSD",])); // This line lets us filter by country codes.
    
  map.on('click', 'countries', function (mapElement) {
    let search_term = mapElement.features[0].properties.NAME;
    let html = ``;
    console.log("---------------------------------\n",search_term);

    fetch(`https://newsapi.org/v2/everything?qInTitle=${search_term}&sortBy=publishedAt&apiKey=${API_KEY}`)
      .then((data) => data.json())
      .then(article => {
        console.log("---------------------------------",article);
        article.articles.slice(0, 5).map(article => {
          html += `
          <h3>${article.title}</h3>
          <ul class="news">
            <li><strong>Content:</strong> ${article.content}</li>
            <li><strong>Description:</strong> ${article.description}</li>
            <li><strong>Author:</strong> ${article.author}</li>
          </ul>
        `
        })
        

        const popup = document.getElementById("popup");
        popup.innerHTML = html;

        // new mapboxgl.Popup() //Create a new popup
        //   .setLngLat(mapElement.lngLat) // Set where we want it to appear (where we clicked)
        //   .setHTML(html) // Add the HTML we just made to the popup
        //   .addTo(map); // Add the popup to the map


      })



  // fetch(`https://restcountries.eu/rest/v2/alpha/${countryCode}`) // Using tempalate tags to create the API request
  //   .then((data) => data.json()) //fetch returns an object with a .json() method, which returns a promise
  //   .then((country) => { //country contains the data from the API request


      

      // -------------------------------------------------------
      // // Let's build our HTML in a template tag
      // const html = ` 
      //   <ul>
      //     <li><h3>${country.name}</h3></li>
      //     <li><strong>Currencies:</strong> ${country.currencies.map((c) => c.code).join(', ')}</li>
      //     <li><strong>Capital:</strong> ${country.capital}</li>
      //     <li><strong>Population:</strong> ${country.population}</li>
      //     <li><strong>Demonym:</strong> ${country.demonym}</li>
      //   </ul>
      // `; // Now we have a good looking popup HTML segment.
      // new mapboxgl.Popup() //Create a new popup
      // .setLngLat(mapElement.lngLat) // Set where we want it to appear (where we clicked)
      // .setHTML(html) // Add the HTML we just made to the popup
      // .addTo(map); // Add the popup to the map
    });
  });
// });
</script>

</body>
</html>